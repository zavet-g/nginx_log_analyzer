# –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –ª–æ–≥–æ–≤ Nginx: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ üöÄ

#### –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø–µ—Ç-–ø—Ä–æ–µ–∫—Ç –¥–ª—è DevOps –∏ –∞–Ω–∞–ª–∏–∑–∞ —Å–µ—Ç–µ–π

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ª–æ–≥–æ–≤ Nginx –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/var/log/nginx/access.log`). –û–Ω–æ –ø–∞—Ä—Å–∏—Ç –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –ª–æ–≥–æ–≤, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ—â–Ω—ã–π API –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞. –≠—Ç–æ –≤–ø–µ—á–∞—Ç–ª—è—é—â–∏–π –ø—Ä–∏–º–µ—Ä –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–∞–∫—Ç–∏–∫ DevOps.

---

## üåü –ó–∞—á–µ–º —ç—Ç–æ—Ç –ø–µ—Ç-–ø—Ä–æ–µ–∫—Ç?

"–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –ª–æ–≥–æ–≤ Nginx" —Ä–µ—à–∞–µ—Ç —Ç–∏–ø–∏—á–Ω—É—é –∑–∞–¥–∞—á—É DevOps: –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–µ–∑–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –ù–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, –Ω—É–∂–Ω–æ –ª–∏ –≤–∞–º —É—Å—Ç—Ä–∞–Ω—è—Ç—å –æ—à–∏–±–∫–∏ 4xx/5xx, –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å IP –∏–ª–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å URL, —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ. –ö–∞–∫ –ø–µ—Ç-–ø—Ä–æ–µ–∫—Ç, –æ–Ω –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –≥–ª—É–±–æ–∫–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å–µ—Ç–µ–≤—ã—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π, –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Kafka, Grafana –∏–ª–∏ ML-–º–æ–¥–µ–ª—è–º–∏ –¥–µ–ª–∞–µ—Ç –µ–≥–æ –ø—Ä–∏–º–µ—Ä–æ–º –≥–æ—Ç–æ–≤–æ–≥–æ –∫ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤—É –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞.

---

## üõ†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–π —Å—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- **Python 3.11+** - –û—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.
- **FastAPI** - –í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π API-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫.
- **SQLAlchemy 2.0 (Async ORM)** - –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å PostgreSQL.
- **PostgreSQL** - –ù–∞–¥–µ–∂–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤.
- **Docker & Docker Compose** - –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ.
- **Pydantic 2.0** - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π.
- **Pytest** - –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤.
- **asyncio & aiofiles** - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
- **Alembic** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
nginx_log_analyzer/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ api/                  # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã FastAPI –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ core/                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –ª–æ–≥–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –ª–æ–≥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ db/                   # –ú–æ–¥–µ–ª–∏, —Å–µ—Å—Å–∏–∏ –∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ CRUD
‚îÇ   ‚îú‚îÄ‚îÄ services/             # –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ª–æ–≥–æ–≤ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
‚îÇ   ‚îî‚îÄ‚îÄ main.py               # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ API
‚îú‚îÄ‚îÄ tests/                    # –ù–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ —Å Pytest
‚îú‚îÄ‚îÄ alembic/                  # –°–∫—Ä–∏–ø—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–π
‚îú‚îÄ‚îÄ docker/                   # Dockerfile –∏ nginx.conf –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ .env                      # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ docker-compose.yml        # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
‚îî‚îÄ‚îÄ README.md                 # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
```

---

## üöÄ –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

```bash
cp .env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` —Å —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ PostgreSQL –∏ –ø—É—Ç–µ–º –∫ –ª–æ–≥–∞–º Nginx.

### 2. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

#### 2.1. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Docker

–°–æ–±–µ—Ä–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å –ø–æ–º–æ—â—å—é Docker Compose:

```bash
docker compose up --build -d
```

#### 2.2. –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å Poetry

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ–µ–∫—Ç–∞):

```bash
poetry config virtualenvs.in-project true
poetry shell
poetry install
```

---

## üéÆ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### API-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–π—Ç–µ —Å —Å–µ—Ä–≤–∏—Å–æ–º —á–µ—Ä–µ–∑ REST API:

- `GET /logs/last?limit=100` - –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100 –∑–∞–ø–∏—Å–µ–π –ª–æ–≥–æ–≤.
- `GET /logs/ip/192.168.1.1` - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ IP-–∞–¥—Ä–µ—Å—É.
- `GET /logs/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ HTTP-–∫–æ–¥–∞–º, URL –∏ IP.
- `GET /logs/errors` - –°–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π —Å 4xx/5xx —Å—Ç–∞—Ç—É—Å–∞–º–∏.

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã —Å Pytest:

```bash
make test
```

### 4. –õ–∏–Ω—Ç–∏–Ω–≥

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:

```bash
make lint
```

### 5. –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é:

```bash
alembic revision --autogenerate -m "Init migration"
```

–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:

```bash
alembic -x data=true upgrade head
```

### 6. –ö—Ä–æ–Ω-–∑–∞–¥–∞—á–∏

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–∞—Ä—Å–∏–Ω–≥ –ª–æ–≥–æ–≤):

```bash
python cli.py tasks.cron.runner run_cron PARSER_GROUP MAIL_LOG_PARSER_JOB
```

### 7. –û—Ç–ª–∞–¥–∫–∞

–û—Ç–ª–∞–¥–∫–∞ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤:

```python
print(str(stmt.compile(compile_kwargs={'literal_binds': True})))
```

---

## üåà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ 

- **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–ª—å–∑–∞**: –†–µ—à–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é –∑–∞–¥–∞—á—É DevOps —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
- **–ü–µ—Ä–µ–¥–æ–≤–æ–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `asyncio` –∏ `aiofiles` –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –†–∞—Å—à–∏—Ä—è–µ–º –¥–æ Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, Kafka, Grafana –∏–ª–∏ ML-–∞–Ω–∞–ª–∏–∑–∞.
- **–ù–∞–¥–µ–∂–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í–∫–ª—é—á–∞–µ—Ç Pytest –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞.
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è**: –ì–æ—Ç–æ–≤ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é —á–µ—Ä–µ–∑ Docker.

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ, –Ω–æ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥ –∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Å–∏—Å—Ç–µ–º.


---